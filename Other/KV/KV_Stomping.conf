input {
  # We're going to assume you've already broken your full message out and just working with the URI.
  generator {
    type => "generated"
    message => 'some=kv wants=to stomp=on things=like type=field' 
    count => 1
  }

  generator {
    type => "generated"
    message => 'some=kv will=not stomp=on things=like the=type' 
    count => 1
  }

}

filter {
    # Lets check if we're going to stomp on the type field.
    if [message] =~ /type=/ {
	# We are, so Let's copy the data to a temporary field, we'll delete it later
        mutate {
	    add_field => { "tmp" => "%{type}" }
	}
    }

    # Now we can use the KV filter to finish it off
    kv {
    }

    if [message] =~ /type=/ {
	# Copy the KV type to new_type
	mutate { add_field => ["new_type", "%{type}"] }

	# Logstash wants to make type an array, so we need to remove it first
	mutate { remove_field => ["type"] }

	# Now we can revert the type field
	mutate {
	    add_field => ["type", "%{tmp}"]
	    remove_field => "tmp"
	}
    }

}

output {
    stdout {
	codec => rubydebug
    }
}
